---
title: 纯静态库
date: 2024-10-13 21:39:52
permalink: /pages/d8c9a7/
categories:
  - CMake笔记
tags:
  - 动态/静态库
author: 
  name: 夏黎辰
  link: https://github.com/zcy946
---

::: warning
本文由ChatGPT生成，请自行甄别。
:::

如果你生成的是 **静态库**，那么生成的文件会是 `.a` 文件（在 MinGW 中）或 `.lib` 文件（在 MSVC 中）。静态库与动态库不同，不会生成 `.dll.a` 这样的导入库。静态库的本质和使用方式如下：

### 静态库的特点：
1. **直接包含代码**：静态库（`.a` 或 `.lib`）包含了库的所有实现代码。在编译和链接阶段，链接器会将所需的库代码嵌入到最终的可执行文件中。因此，编译后生成的 `.exe` 是一个独立的文件，运行时不再需要外部的动态库。

2. **不依赖运行时的 `.dll` 文件**：当你链接到静态库时，程序在运行时不会依赖动态库（`.dll` 文件），因为所有的依赖代码都已经在编译时被嵌入到可执行文件中。

3. **不会生成导入库**：静态库没有所谓的导入库（`.dll.a` 或 `.lib`），因为静态库本身就是编译和链接的直接目标。所有符号解析和代码引用都发生在编译时。

### 静态库生成过程：
- **MinGW（或其他 GCC 系工具链）**：使用 `ar` 工具来创建静态库，生成 `.a` 文件。通常，静态库文件命名为 `libname.a`，比如 `libprotobuf.a`。
  
  示例命令：
  ```bash
  gcc -c mylib.c -o mylib.o   # 生成目标文件
  ar rcs libmylib.a mylib.o   # 生成静态库文件
  ```

- **MSVC（Visual Studio）**：使用 `LIB` 工具生成静态库，生成 `.lib` 文件。MSVC 环境下，静态库的文件后缀通常是 `.lib`。

### 使用静态库：
1. **链接静态库**：在使用静态库时，你的编译命令或构建系统会链接到 `.a` 或 `.lib` 文件。比如在 CMake 中，链接静态库通常使用 `target_link_libraries()` 指向静态库路径：
   
   ```cmake
   target_link_libraries(my_executable "path_to_lib/libprotobuf.a")
   ```

2. **编译时嵌入库代码**：在编译可执行文件时，链接器会将静态库中的所有必要代码嵌入到可执行文件中，生成的 `.exe` 文件会包含所有依赖，因此不需要额外的 `.dll` 文件。

### 生成静态库时注意：
- 静态库的好处是部署方便，执行时不需要额外的库文件，但也有缺点：所有使用静态库的可执行文件都包含重复的库代码，可能导致文件体积变大。
  
- 如果你希望在发布程序时不依赖动态库，生成和链接静态库是个不错的选择，但如果多个程序共享库，动态库可能更节省内存和磁盘空间。

### 总结：
- **静态库**（`.a` 或 `.lib`）包含完整的库实现，编译时嵌入到最终的可执行文件中，不会生成 `.dll.a` 或 `.lib` 作为导入库。
- 静态库链接后，程序在运行时不需要任何 `.dll` 文件。
- 静态库的优点是独立性，缺点是文件体积会较大。

如果你在生成的是静态库，只需要 `.a`（或 `.lib`），不会生成 `.dll.a` 这样的导入库。